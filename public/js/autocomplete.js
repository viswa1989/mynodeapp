"use strict";angular.module("ui.autocomplete",[]).directive("uiAutocomplete",["$timeout","$exceptionHandler",function(e,t){function n(e,t){var n=new RegExp($.ui.autocomplete.escapeRegex(t),"i");return $.grep(e,function(e){return n.test($("<div>").html(e.label||e.value||e).text())})}var o=$.ui.autocomplete.prototype,i=o._initSource,u=Array.prototype.slice;return $.extend(o,{_initSource:function(){this.options.html&&$.isArray(this.options.source)?this.source=function(e,t){t(n(this.options.source,e.term))}:i.call(this)},_normalize:function(e){return $.map(e,function(e){return e&&"object"==typeof e?$.extend({label:e.label||e.value,value:e.value||e.label},e):{label:e+"",value:e}})},_renderItemData:function(e,t){var n=t.groupLabel||t.label;return t.groupLabel?n=$("<div>").append(n).addClass("ui-menu-group"):this.options.html?("object"==typeof n&&(n=$(n)),("object"!=typeof n||n.length>1||!n.is("a"))&&(n=$("<a>").append(n))):n=$("<a>").text(n),$("<li>").append(n).appendTo(e).data("ui-autocomplete-item",t)},_resizeMenu:function(){var e=this;setTimeout(function(){var t=e.menu.element,n=t.css("max-height")||0,o=Math.max(t.width("").outerWidth()+1,e.element.outerWidth()),i=(e.element.height(),$(window).height()-e.options.outHeight-t.offset().top);i=n&&i>n?n:i,t.css({width:o,maxHeight:i})},10)}}),{require:"ngModel",link:function(o,i,a,l){function r(e){g(h)&&(l.$viewValue||0===l.$viewValue?e&&e.item&&(e.item.label=g(e.item.label)?$("<div>").append(e.item.label).html():e.item.label,b(h,e.item)):p(h),v(l.$viewChangeListeners,function(e){try{e()}catch(e){t(e)}}))}function c(){l.$setViewValue(""),l.$render(),r()}function s(){w.options.focusOpen&&!f&&i.autocomplete("search","")}function p(e){if(g(e)){var t=/^\$/;v(e,function(n,o){var i=typeof n;t.test(o)||("number"===i?e[o]=0:"string"===i?e[o]="":"boolean"===i?e[o]=!1:g(n)&&p(n))})}}var f=!1,d=null,m={},h=null,v=angular.forEach,g=angular.isObject,b=angular.extend,w=o.$eval(a.uiAutocomplete),y=angular.bind(i,i.val),x=["close","destroy","disable","enable","instance","option","search","widget"],V=["change","close","create","focus","open","response","search","select"],H=o.$watch(a.ngModel,function(e){g(h=e)&&(l.$formatters.push(function(e){return e.value}),l.$parsers.push(function(e){return h.value=e,h}),o.$watch(a.ngModel,function(e){y()!==e.value&&(l.$viewValue=e.value,l.$render())},!0),l.$pristine=!1,l.$setViewValue(h.value),l.$pristine=!0),e&&H()}),L={open:function(e,t){f=!0,d=null},close:function(e,t){f=!1},select:function(t,n){d=n,e(function(){i.blur()},0)},change:function(e,t){var n=y(),i=!1;d&&d.item&&-1!==n.indexOf(d.item.value)&&(n=d.item.value,i=!0),o.$apply(function(){w.options.onlySelectValid&&l.$setValidity("onlyselect",i),null===n?l.$render():""===n?r():l.$viewValue!==n&&(l.$setViewValue(n),l.$render(),r(d))})}};g(w)&&(w.methods={},w.options=function(e){return e=g(e)?e:{},e.disabled=!e.source||e.disabled,e.appendTo=e.appendTo||i.parents(".ng-view")[0]||i.parents("[ng-view]")[0]||null,e.minLength=e.focusOpen?0:e.minLength,e.outHeight=e.outHeight||0,e.position=e.position||{my:"left top",at:"left bottom",collision:"flipfit"},e}(w.options),v(V,function(e){var t=w.options[e];t="function"==typeof t?t:angular.noop,m[e]=function(n,o){L[e]&&L[e](n,o),t(n,o),w.events&&"function"==typeof w.events[e]&&w.events[e](n,o)}}),v(x,function(e){w.methods[e]=function(){var t=u.call(arguments);return t.unshift(e),i.autocomplete.apply(i,t)}}),w.methods.filter=n,w.methods.clean=c,i.on("focus",s),i.autocomplete(b({},w.options,m)),w.widget=i.autocomplete("widget"))}}}]);