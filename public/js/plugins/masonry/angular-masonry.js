!function(){"use strict";angular.module("wu.masonry",[]).controller("MasonryCtrl",["$scope","$element","$timeout",function(e,n,r){function o(e){e.addClass("loaded")}var t={},s=[],i=!1,a=this,c=null;this.preserveOrder=!1,this.scheduleMasonryOnce=function(){var e=arguments;s.filter(function(n){return n[0]===e[0]}).length>0||this.scheduleMasonry.apply(null,arguments)},this.scheduleMasonry=function(){c&&r.cancel(c),s.push([].slice.call(arguments)),c=r(function(){i||(s.forEach(function(e){n.masonry.apply(n,e)}),s=[])},30)},this.appendBrick=function(e,r){function s(){0===Object.keys(t).length&&n.masonry("resize"),void 0===t[r]&&(t[r]=!0,o(e),n.masonry("appended",e,!0))}function c(){a.scheduleMasonryOnce("layout")}i||(a.preserveOrder?(s(),e.imagesLoaded(c)):e.imagesLoaded(function(){s(),c()}))},this.removeBrick=function(e,r){i||(delete t[e],n.masonry("remove",r),this.scheduleMasonryOnce("layout"))},this.destroy=function(){i=!0,n.data("masonry")&&n.masonry("destroy"),e.$emit("masonry.destroyed"),t=[]},this.reload=function(){n.masonry(),e.$emit("masonry.reloaded")}}]).directive("masonry",function(){return{restrict:"AE",controller:"MasonryCtrl",link:{pre:function(e,n,r,o){var t=e.$eval(r.masonry||r.masonryOptions),s=angular.extend({itemSelector:r.itemSelector||".masonry-brick",columnWidth:parseInt(r.columnWidth,10)},t||{});n.masonry(s);var i=e.$eval(r.preserveOrder);o.preserveOrder=!1!==i&&void 0!==r.preserveOrder,e.$emit("masonry.created",n),e.$on("$destroy",o.destroy)}}}}).directive("masonryBrick",function(){return{restrict:"AC",require:"^masonry",scope:!0,link:{pre:function(e,n,r,o){var t,s=e.$id;o.appendBrick(n,s),n.on("$destroy",function(){o.removeBrick(s,n)}),e.$on("masonry.reload",function(){o.reload()}),e.$watch("$index",function(){void 0!==t&&t!==e.$index&&(o.scheduleMasonryOnce("reloadItems"),o.scheduleMasonryOnce("layout")),t=e.$index})}}}})}();