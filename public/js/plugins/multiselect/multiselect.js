angular.module("ui.multiselect",[]).factory("optionParser",["$parse",function(e){var n=/^\s*(.*?)(?:\s+as\s+(.*?))?\s+for\s+(?:([\$\w][\$\w\d]*))\s+in\s+(.*)$/;return{parse:function(i){var l=i.match(n);if(!l)throw new Error("Expected typeahead specification in form of '_modelValue_ (as _label_)? for _item_ in _collection_' but got '"+i+"'.");return{itemName:l[3],source:e(l[4]),viewMapper:e(l[2]||l[1]),modelMapper:e(l[1])}}}}]).directive("multiselect",["$parse","$document","$compile","optionParser",function(e,n,i,l){return{restrict:"E",require:"ngModel",link:function(n,t,c,a){function r(){k.items.length=0;for(var e=h.source(n),i=0;i<e.length;i++){var l={};l[h.itemName]=e[i],k.items.push({label:h.viewMapper(l),model:e[i],checked:!1})}}function o(){if(!a.$modelValue||!a.$modelValue.length)return k.header="Select";if(m)k.header="",angular.forEach(a.$modelValue,function(e,n){angular.isDefined(e.name)&&""!=e.name&&null!=e.name&&(n>0&&(k.header=k.header+", "),k.header=k.header+e.name)});else{var e={};e[h.itemName]=a.$modelValue,k.header=h.viewMapper(e)}}function u(e){e.checked?k.uncheckAll():(k.uncheckAll(),e.checked=!e.checked),d(!1)}function s(e){e.checked=!e.checked,d(!0)}function d(e){var n;e?(n=[],angular.forEach(k.items,function(e){e.checked&&n.push(e.model)})):angular.forEach(k.items,function(e){if(e.checked)return n=e.model,!1}),a.$setViewValue(n)}function f(e){angular.isArray(e)?angular.forEach(e,function(e){angular.forEach(k.items,function(n){angular.equals(n.model,e)&&(n.checked=!0)})}):angular.forEach(k.items,function(n){if(angular.equals(n.model,e))return n.checked=!0,!1})}var p=c.options,h=l.parse(p),m=!!c.multiple,g=!1,k=n.$new(),b=c.change||angular.noop;k.items=[],k.header="Select",k.multiple=m,k.enablefilter=!!c.isfilter,k.currentMenu=c.currentmenu,k.disabled=!1,k.confirmupdate=c.confirmAction,n.$on("$destroy",function(){k.$destroy()});var $=angular.element("<multiselect-popup></multiselect-popup>");(c.required||c.ngRequired)&&(g=!0),c.$observe("required",function(e){g=e}),k.$watch(function(){return angular.isDefined(c.disabled)?c.disabled:e(c.disabled)(n)},function(e){k.disabled=e}),k.$watch(function(){return angular.isDefined(c.isfilter)?c.isfilter:e(c.isfilter)(n)},function(e){k.enablefilter=e}),k.$watch(function(){return e(c.multiple)(n)},function(e){m=e||!1}),k.$watch(function(){return h.source(n)},function(e){angular.isDefined(e)&&r()}),k.$watch(function(){return a.$modelValue},function(e,n){angular.isDefined(e)&&(f(e),k.$eval(b)),o(),a.$setValidity("required",k.valid())},!0),r(),t.append(i($)(k)),k.valid=function(){if(!g)return!0;var e=a.$modelValue;return angular.isArray(e)&&e.length>0||!angular.isArray(e)&&null!=e},k.checkAll=function(){m&&(angular.forEach(k.items,function(e){e.checked=!0}),d(!0))},k.uncheckAll=function(){angular.forEach(k.items,function(e){e.checked=!1}),d(!0)},k.select=function(e){!1===m?(u(e),k.toggleSelect()):s(e)}}}}]).directive("multiselectPopup",["$document",function(e){return{restrict:"AE",scope:!0,replace:!0,templateUrl:"multiselect.tmpl.html",link:function(n,i,l){function t(l){c(l.target,i.find(l.target.tagName))||(i.removeClass("open"),n.$eval(n.$parent.confirmupdate),e.unbind("click",t),n.$digest())}n.isVisible=!1,n.toggleSelect=function(){i.hasClass("open")?(i.removeClass("open"),e.unbind("click",t)):(i.addClass("open"),n.focus(),e.bind("click",t))},n.focus=function(){i.find("input")[0].focus()};var c=function(e,n){for(var i=0;i<n.length;i++)if(e==n[i])return!0;return!1}}}}]).run(["$templateCache",function(e){e.put("multiselect.tmpl.html",'<div class="dropdown"><button class="btn" ng-click="toggleSelect()" ng-disabled="disabled" ng-class="{\'error\': !valid()}"><span class="pull-left selecteditem_limit">{{header}}</span><span class="glyphicon glyphicon-triangle-bottom pull-right"></span></button><ul class="dropdown-menu"><li><input class="input-block-level" type="text" ng-model="searchText.label" autofocus="autofocus" placeholder="Filter"/></li><li ng-show="multiple"></li><li ng-if="enablefilter" ng-repeat="i in items | filter:searchText | subcategoryFilter:enablefilter:customercomplaint.category:complaintForm:currentMenu"><a ng-if="!i.disabled" ng-click="select(i); focus()"><i ng-class="{\'glyphicon glyphicon-ok\': i.checked, \'glyphicon\': !i.checked}"></i> {{i.label}}</a><a ng-if="i.disabled" style="color: #9c9c9c;"><i ng-class="{\'glyphicon glyphicon-ok\': i.checked, \'glyphicon\': !i.checked}"></i> {{i.label}}</a></li><li ng-if="!enablefilter" ng-repeat="i in items | filter:searchText"><a ng-click="select(i); focus()"><i ng-class="{\'glyphicon glyphicon-ok\': i.checked, \'glyphicon\': !i.checked}"></i> {{i.label}}</a></li></ul></div>')}]);